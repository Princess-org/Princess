import json
import c::clexer

def lex(str: String) -> &Json {
    let tokens = lex(str, "<snippet>")
    let res = tokens_to_json(tokens)
    delete(tokens)
    return res
}

def #test test_empty_file {
    assert lex("") == json::parse("""[\
        { "kind": "START" },
        { "kind": "EOF" }
    ]""")
}

def #test test_int_literal {
    assert lex("123456")[1] == json::parse("""
        { "kind": "INTEGER", "value": 123456 }    
    """)
    assert lex("0777")[1] == json::parse("""
        { "kind": "INTEGER", "value": 511 }
    """)
    assert lex("0xDEADBABE")[1] == json::parse("""
        { "kind": "INTEGER", "value": 3735927486 }
    """)
    assert lex("0b100100")[1] == jsoon::parse("""
        { "kind": "INTEGER", "value": 36 }
    """)
}