import json
import c::clexer

def lex(str: String) -> &Json {
    let tokens = lex(str, "<snippet>")
    let res = tokens_to_json(tokens)
    delete(tokens)
    return res
}

def #test test_empty_file {
    assert lex("") == json::parse("""[\
        { "kind": "START" },
        { "kind": "EOF" }
    ]""")
}

def #test test_pp_number {
    assert lex("123456")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "123456" }    
    """)
    assert lex("0777")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "0777" }
    """)
    assert lex("0xDEADBABE")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "0xDEADBABE" }
    """)
    assert lex("0b100100")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "0b100100" }
    """)
    assert lex("0e+20")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "0e+20" }
    """)
    assert lex("0thisisanumber")[1] == json::parse("""
        { "kind": "PP_NUMBER", "value": "0thisisanumber" }
    """)
}